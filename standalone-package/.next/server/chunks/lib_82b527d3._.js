module.exports=[1461,e=>{"use strict";e.s(["sseManager",()=>n]);class t{connections=new Map;addConnection(e,t,n){let o=this.connections.get(e)||[];o.push({userId:e,controller:t,encoder:n}),this.connections.set(e,o),console.log(`SSE: User ${e} connected. Total connections: ${o.length}`)}removeConnection(e,t){let n=(this.connections.get(e)||[]).filter(e=>e.controller!==t);n.length>0?this.connections.set(e,n):this.connections.delete(e),console.log(`SSE: User ${e} disconnected. Remaining connections: ${n.length}`)}sendToUser(e,t){let n=this.connections.get(e);if(!n||0===n.length)return void console.log(`SSE: No active connections for user ${e}`);let o=`data: ${JSON.stringify(t)}

`;n.forEach(t=>{try{t.controller.enqueue(t.encoder.encode(o)),console.log(`SSE: Sent notification to user ${e}`)}catch(n){console.error(`SSE: Error sending to user ${e}:`,n),this.removeConnection(e,t.controller)}})}getConnectionCount(e){return this.connections.get(e)?.length||0}}let n=new t},28907,e=>{"use strict";e.s(["createNotification",()=>c,"logUserActivity",()=>r,"notifyNewComment",()=>a,"notifyStatusChange",()=>i,"notifyTicketAssignment",()=>s],28907);var t=e.i(15270);let n=e=>{switch(e){case"NEW":return"New";case"IN_PROGRESS":return"On Process";case"ON_HOLD":return"On Hold";case"DONE":return"Done";case"CANCEL":return"Cancel";default:return e}};var o=e.i(1461);async function r(e,n,o,r,c,s){try{await t.prisma.userActivity.create({data:{userId:e,action:n,ticketId:o,ticketNumber:r,ticketType:c,details:s}})}catch(e){console.error("Log user activity error:",e)}}async function c(e,n,r,c,s,i){try{let a=await t.prisma.notification.create({data:{userId:e,type:n,message:r,ticketId:c,ticketNumber:s,ticketType:i}});return o.sseManager.sendToUser(e,{type:"new_notification",data:a}),a}catch(e){console.error("Create notification error:",e)}}async function s(e,n,o,r){try{let s=await t.prisma.user.findUnique({where:{username:e}});s&&await c(s.id,"assignment",`You have been assigned to ticket ${n}`,r,n,o)}catch(e){console.error("Notify ticket assignment error:",e)}}async function i(e,t,o,r,s,i){try{let a=n(o),l=n(r);await c(e,"status_change",`Ticket ${t} status changed from ${a} to ${l}`,i,t,s)}catch(e){console.error("Notify status change error:",e)}}async function a(e,t,n,o,r){try{await c(e,"comment",`${n} commented on ticket ${t}`,r,t,o)}catch(e){console.error("Notify new comment error:",e)}}}];

//# sourceMappingURL=lib_82b527d3._.js.map