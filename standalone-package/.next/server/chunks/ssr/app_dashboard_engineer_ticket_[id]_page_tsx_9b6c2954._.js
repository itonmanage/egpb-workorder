module.exports=[46593,a=>{"use strict";a.s(["default",()=>v]);var b=a.i(87924),c=a.i(72131),d=a.i(71630),e=a.i(50944),f=a.i(38246),g=a.i(2919),h=a.i(41675),i=a.i(92e3),j=a.i(46842),k=a.i(24987),l=a.i(73320),m=a.i(38632),n=a.i(71987),o=a.i(80423),p=a.i(98817),q=a.i(12140),r=a.i(23292);let s={NEW:"New",IN_PROGRESS:"On Process",ON_HOLD:"On Hold",DONE:"Done",CANCEL:"Cancel"},t=a=>{switch(a.toUpperCase()){case"NEW":return"bg-blue-100 text-blue-700 border-blue-200";case"IN_PROGRESS":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"ON_HOLD":return"bg-orange-100 text-orange-700 border-orange-200";case"DONE":return"bg-green-100 text-green-700 border-green-200";case"CANCELLED":case"CANCEL":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},u=a=>s[a?.toUpperCase()]||a||"Unknown";function v(){let a=(0,e.useParams)().id;return(0,b.jsx)(w,{ticketId:a})}function w({ticketId:e}){let[s,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(!1),S=(0,c.useCallback)(async()=>{try{x(!0);let a=await d.apiClient.auth.getUser();if(a.success&&a.data?.user){let b=a.data.user.role;B("ADMIN"===b||"ENGINEER_ADMIN"===b)}let b=await d.apiClient.engineerTickets.get(e);if(!b.success||!b.data){let a=b.error;throw Error(a||"Failed to fetch ticket")}v(b.data),L(b.data.adminNotes||""),N(b.data.informationBy||""),P(b.data.assignTo||""),b.data.user?.username?z(b.data.user.username):z("Unknown User");let c=(b.data.images||[]).map(a=>{let b=a.originalName||a.imageUrl?.split("/")?.pop()||"image.jpg";return{id:a.id,ticket_id:a.ticketId,image_url:a.imageUrl,image_name:b,is_completion_image:a.isCompletion,is_admin_upload:a.isCompletion,created_at:a.createdAt}});H(c.filter(a=>!a.is_completion_image)),J(c.filter(a=>a.is_completion_image))}catch(a){console.error("Error fetching ticket:",a)}finally{x(!1)}},[e]),T=async()=>{if(0!==C.length){F(!0);try{let{uploadEngineerTicketImages:b}=await a.A(52832),c=await b(e,C,!0);if(c.success){r.toast.success("Images uploaded successfully!"),D([]);let a=document.getElementById("adminImageUpload");a&&(a.value=""),await S()}else r.toast.error(`Failed to upload images: ${c.error}`)}catch(a){console.error("Error uploading images:",a),r.toast.error("Failed to upload images")}finally{F(!1)}}};return((0,c.useEffect)(()=>{S()},[S]),w)?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,b.jsx)("div",{className:"text-black",children:"Loading ticket details..."})}):s?(0,b.jsx)("div",{className:"min-h-screen bg-white p-6 md:p-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)(f.default,{href:"/dashboard/engineer",className:"inline-flex items-center text-sm text-black hover:text-green-600 mb-6 transition-colors",children:[(0,b.jsx)(g.ArrowLeft,{size:16,className:"mr-1"}),"Back to Engineer Dashboard"]}),(0,b.jsxs)("div",{className:"bg-white rounded-3xl shadow-sm border border-green-100 overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-8 border-b border-green-100 bg-green-50",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-sm font-mono text-black bg-white px-2 py-1 rounded border border-green-200",children:s.ticketNumber||`#${s.id.slice(0,8)}`}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${t(s.status)}`,children:u(s.status)})]}),(0,b.jsxs)("div",{className:"text-sm text-black flex items-center",children:[(0,b.jsx)(h.Calendar,{size:14,className:"mr-1.5"}),new Date(s.createdAt).toLocaleString()]})]}),(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-black",children:s.title})]}),(0,b.jsxs)("div",{className:"p-8 grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"md:col-span-2 space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-black uppercase tracking-wider mb-3",children:"Description"}),(0,b.jsx)("div",{className:"prose max-w-none text-black bg-green-50 p-6 rounded-2xl border border-green-100",children:(0,b.jsx)("p",{className:"whitespace-pre-wrap",children:s.description||"No description provided"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-black uppercase tracking-wider mb-3",children:"Attached Images"}),(0,b.jsx)("div",{className:"bg-green-50 p-6 rounded-2xl border border-green-100",children:G.length>0?(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:G.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(n.default,{src:a.image_url,alt:a.image_name,fill:!0,className:"object-cover rounded-lg border border-green-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(a.image_url,"_blank")}),(0,b.jsx)("p",{className:"text-xs text-black mt-1 truncate",children:a.image_name})]},a.id))}):(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-black",children:[(0,b.jsx)(m.Image,{size:20,className:"text-green-600"}),(0,b.jsx)("p",{className:"text-sm",children:"No images attached"})]}),(0,b.jsx)("p",{className:"text-xs text-black mt-2 opacity-70",children:"User did not upload any images"})]})})]}),A&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-black uppercase tracking-wider mb-3",children:"Admin - Upload Completion Images"}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-green-200",children:[(0,b.jsxs)("div",{className:"border-2 border-dashed border-green-200 rounded-xl p-6 text-center hover:bg-green-50 transition-colors",children:[(0,b.jsx)("input",{type:"file",id:"adminImageUpload",multiple:!0,accept:"image/*",onChange:a=>{a.target.files&&D(Array.from(a.target.files))},className:"hidden"}),(0,b.jsxs)("label",{htmlFor:"adminImageUpload",className:"cursor-pointer block",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,b.jsx)(l.Upload,{size:24})}),(0,b.jsx)("p",{className:"text-sm text-black font-medium",children:"Click to upload completion images"}),(0,b.jsx)("p",{className:"text-xs text-black mt-1",children:"PNG, JPG, JPEG, GIF, WebP"})]}),C.length>0&&(0,b.jsxs)("div",{className:"mt-4 text-left",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-black mb-2",children:"Selected images:"}),(0,b.jsx)("ul",{className:"space-y-1 mb-4",children:C.map((a,c)=>(0,b.jsxs)("li",{className:"text-sm text-black flex items-center gap-2",children:[(0,b.jsx)("span",{className:"w-2 h-2 bg-green-600 rounded-full"}),a.name," (",(a.size/1024).toFixed(1)," KB)"]},c))}),(0,b.jsx)("button",{onClick:T,disabled:E,className:"w-full px-4 py-2 bg-green-600 text-white font-medium rounded-xl hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:E?"Uploading...":"Upload Images"})]})]}),I.length>0&&(0,b.jsxs)("div",{className:"mt-6",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-black mb-3",children:"Completion Images"}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:I.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(n.default,{src:a.image_url,alt:a.image_name,fill:!0,className:"object-cover rounded-lg border border-green-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(a.image_url,"_blank")}),(0,b.jsx)("p",{className:"text-xs text-black mt-1 truncate",children:a.image_name})]},a.id))})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-green-50 p-6 rounded-2xl border border-green-100",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-black uppercase tracking-wider mb-4",children:"Details"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Area"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(k.MapPin,{size:16,className:"mr-2 text-green-600"}),s.location||"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Location"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(k.MapPin,{size:16,className:"mr-2 text-green-600"}),s.title||"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Department"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(j.User,{size:16,className:"mr-2 text-green-600"}),s.department||"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Requested By"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(j.User,{size:16,className:"mr-2 text-green-600"}),y||"Loading..."]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Position"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(j.User,{size:16,className:"mr-2 text-green-600"}),s.user?.position||"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Telephone Extension"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(j.User,{size:16,className:"mr-2 text-green-600"}),s.user?.telephoneExtension||"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-black block mb-1",children:"Type of Damage"}),(0,b.jsxs)("div",{className:"flex items-center font-medium text-black",children:[(0,b.jsx)(i.AlertCircle,{size:16,className:"mr-2 text-green-600"}),s.typeOfDamage||"-"]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-green-100 shadow-sm",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-black uppercase tracking-wider mb-4",children:A?"Admin Actions":"Ticket Status"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"text-sm text-black block mb-2",children:"Current Status:"}),A?(0,b.jsx)(o.default,{ticketId:s.id,currentStatus:s.status?.toUpperCase()||"NEW",onUpdate:S,tableName:"engineer_tickets",assignTo:O,adminNotes:K,savedAssignTo:s.assignTo,savedAdminNotes:s.adminNotes}):(0,b.jsx)("div",{className:`px-4 py-2 rounded-xl border-2 font-medium text-sm text-center ${t(s.status)}`,children:u(s.status)})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"text-sm text-black block mb-2",children:"Assign To:"}),A?(0,b.jsx)(p.AssigneeInput,{value:O,onChange:P,placeholder:"Type assignee name...",className:"w-full px-4 py-3 rounded-xl border border-green-200 bg-white text-black focus:outline-none focus:ring-2 focus:ring-green-400 transition-all",type:"Engineer"}):(0,b.jsx)("div",{className:"px-4 py-3 rounded-xl border border-green-200 bg-green-50 text-black",children:s.assignTo||"Not assigned yet"})]}),(A||s.adminNotes)&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm text-black block mb-2",children:A?"Admin Notes:":"Notes from Admin:"}),A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("textarea",{value:K,onChange:a=>L(a.target.value),placeholder:"Add internal notes here...",rows:4,className:"w-full px-4 py-3 rounded-xl border border-green-200 bg-white text-black focus:outline-none focus:ring-2 focus:ring-green-400 transition-all resize-none"}),(0,b.jsx)("label",{className:"text-sm text-black block mt-4 mb-2",children:"Information by:"}),(0,b.jsxs)("select",{value:M,onChange:a=>N(a.target.value),className:"w-full px-4 py-3 rounded-xl border border-green-200 bg-white text-black focus:outline-none focus:ring-2 focus:ring-green-400 transition-all",children:[(0,b.jsx)("option",{value:"",children:"Select information source"}),(0,b.jsx)("option",{value:"By QR Code(Comp.)",children:"By QR Code(Comp.)"}),(0,b.jsx)("option",{value:"By Phone",children:"By Phone"}),(0,b.jsx)("option",{value:"By Line",children:"By Line"}),(0,b.jsx)("option",{value:"By Work Order paper",children:"By Work Order paper"}),(0,b.jsx)("option",{value:"By 60 Point",children:"By 60 Point"}),(0,b.jsx)("option",{value:"By Other",children:"By Other"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,b.jsxs)("div",{children:[Q&&(0,b.jsx)("p",{className:"text-xs text-green-600",children:"Saving..."}),!Q&&s.updatedAt&&(0,b.jsxs)("p",{className:"text-xs text-black",children:["Last updated: ",new Date(s.updatedAt).toLocaleString()]})]}),(0,b.jsx)("button",{onClick:async()=>{let a=O!==(s.assignTo||""),b=K!==(s.adminNotes||""),c=M!==(s.informationBy||"");if(a||b||c){R(!0);try{let a=await d.apiClient.engineerTickets.update(s.id,{assignTo:O,adminNotes:K,informationBy:M});if(!a.success)throw Error(a.error||"Failed to save");await S(),r.toast.success("Saved successfully!")}catch(a){console.error("Error saving:",a),r.toast.error("Failed to save")}finally{R(!1)}}},disabled:Q,className:"px-4 py-2 bg-green-600 text-white font-medium rounded-xl hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:Q?"Saving...":"Save"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"px-4 py-3 rounded-xl border border-green-200 bg-green-50 text-black whitespace-pre-wrap",children:s.adminNotes||"No notes from admin yet."}),s.informationBy&&(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm text-black block mb-2",children:"Information by:"}),(0,b.jsx)("div",{className:"px-4 py-3 rounded-xl border border-green-200 bg-green-50 text-black",children:s.informationBy})]}),s.updatedAt&&(0,b.jsxs)("p",{className:"text-xs text-black mt-2",children:["Last updated: ",new Date(s.updatedAt).toLocaleString()]})]})]}),!A&&I.length>0&&(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-green-100",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-black mb-3",children:"Completion Photos from Admin"}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:I.map(a=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(n.default,{src:a.image_url,alt:a.image_name,fill:!0,className:"object-cover rounded-lg border border-green-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(a.image_url,"_blank")}),(0,b.jsx)("p",{className:"text-xs text-black mt-1 truncate",children:a.image_name})]},a.id))})]})]})]})]})]}),s&&(0,b.jsx)(q.ActivityTimeline,{ticketId:s.id,ticketType:"engineer"})]})}):null}}];

//# sourceMappingURL=app_dashboard_engineer_ticket_%5Bid%5D_page_tsx_9b6c2954._.js.map